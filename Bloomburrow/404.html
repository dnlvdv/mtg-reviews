<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- Set the base so all relative URLs are resolved from /mtg-reviews/ -->
  <base href="/mtg-reviews/">
  <title>Card Review</title>
  <meta name="description" content="Dynamic Card Review for Bloomburrow MTG cards">
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    /* Basic Styles */
    body {
      font-family: 'Roboto', sans-serif;
      background: #121212;
      color: #e0e0e0;
      margin: 0;
      padding: 20px;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
    }
    nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #292929;
      padding: 15px 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      margin-bottom: 20px;
    }
    nav a {
      color: #ffffff;
      text-decoration: none;
      font-size: 18px;
      font-weight: bold;
      margin-right: 10px;
    }
    .card-detail {
      background: #2b2b2b;
      padding: 20px;
      border-radius: 10px;
    }
    .card-detail h1 {
      margin-top: 0;
    }
    .card-image {
      max-width: 100%;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .back-link {
      display: inline-block;
      margin-top: 20px;
      color: #ff6600;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Navigation Bar -->
    <nav>
      <a href="/">Home</a>
      <a href="Bloomburrow/">Bloomburrow</a>
    </nav>

    <!-- Container for Card Details -->
    <div id="cardDetail" class="card-detail">
      <h1>Loading card details...</h1>
    </div>
  </div>

  <script>
    // This function parses the clean URL.
    // Example URL: /mtg-reviews/Bloomburrow/46/dire-downdraft
    function parseCleanURL() {
      // window.location.pathname returns "/mtg-reviews/Bloomburrow/46/dire-downdraft"
      const parts = window.location.pathname.split('/').filter(Boolean);
      // Remove the "mtg-reviews" part (since our base is /mtg-reviews/)
      if (parts[0] === "mtg-reviews") {
        parts.shift();
      }
      // Now we expect parts[0] to be "Bloomburrow", parts[1] to be card number, parts[2] to be card slug.
      if(parts.length >= 3 && parts[0].toLowerCase() === "bloomburrow") {
        return {
          cardNumber: parts[1],
          cardSlug: parts[2]
        };
      }
      return null;
    }

    // Convert URL slug (e.g. "dire-downdraft") into a proper card name ("Dire Downdraft")
    function slugToCardName(slug) {
      return slug.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');
    }

    // Main function to load the dynamic card review
    function loadCardDetail() {
      const params = parseCleanURL();
      const cardDetailContainer = document.getElementById('cardDetail');

      if (!params) {
        cardDetailContainer.innerHTML = "<h1>No card specified.</h1>";
        return;
      }

      const cardNumber = params.cardNumber;
      const cardSlug = params.cardSlug;
      const cardName = slugToCardName(cardSlug);

      // Fetch card data from Bloomburrow/blb.json (relative to the base href)
      fetch("Bloomburrow/blb.json")
        .then(response => response.json())
        .then(data => {
          let cards;
          if(data.data && Array.isArray(data.data.cards)) {
            cards = data.data.cards;
          } else if(Array.isArray(data)) {
            cards = data;
          } else {
            cards = [data];
          }
          // Find the card matching the given name (case-insensitive) and card number.
          const card = cards.find(c => c.name.toLowerCase() === cardName.toLowerCase() && c.number === cardNumber);
          if (!card) {
            cardDetailContainer.innerHTML = "<h1>Card not found.</h1>";
            return;
          }

          // Build the image URL.
          // Images are assumed to be in the root folder "Pictures 2" under /mtg-reviews/
          let imageUrl = "Pictures 2/" + card.name.replace(/[^\w]/g, '_');
          if(card.number && card.artist) {
            imageUrl += "_" + card.number + "_" + card.artist.replace(/[^\w]/g, '_') + ".png";
          } else {
            imageUrl += ".png";
          }

          // Construct the HTML for the card detail view.
          const html = `
            <h1>${card.name} Card Review</h1>
            <img src="${imageUrl}" alt="${card.name}" class="card-image" onerror="this.onerror=null;this.src='Pictures/placeholder.png';" />
            <p><strong>Type:</strong> ${card.type || "N/A"}</p>
            <p><strong>Oracle Text:</strong> ${card.text || "N/A"}</p>
            <p><strong>Flavor Text:</strong> ${card.flavorText || "N/A"}</p>
            <p><strong>Artist:</strong> ${card.artist || "N/A"}</p>
            <a href="Bloomburrow/" class="back-link">‚Üê Back to Bloomburrow</a>
          `;
          cardDetailContainer.innerHTML = html;
          // Optionally update the document title and meta description.
          document.title = card.name + " Card Review";
          let metaDesc = document.querySelector('meta[name="description"]');
          if(metaDesc) {
            metaDesc.setAttribute("content", "In-depth review of " + card.name + ". " + (card.text || ""));
          }
        })
        .catch(error => {
          console.error("Error loading card data:", error);
          cardDetailContainer.innerHTML = "<h1>Error loading card details.</h1>";
        });
    }

    document.addEventListener("DOMContentLoaded", loadCardDetail);
  </script>
</body>
</html>
